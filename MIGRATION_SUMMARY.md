# üìã Migration Summary

## –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### 1. `migrate_prod_db.py` - –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–∏–≥—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—É—é –ø—Ä–æ–¥–∞–∫—à–Ω –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∫ –Ω–æ–≤–æ–π —Å—Ö–µ–º–µ

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (budget_rollover, password_reset_tokens, income_backup_monthly, income_daily, source_category_rules)
- ‚úÖ –ú–∏–≥—Ä–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `currency` –≤ `default_currency`
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python migrate_prod_db.py                    # –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ë–î
python migrate_prod_db.py instance/budget.db # –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –ø—É—Ç–∏
```

### 2. `migrate.sh` - –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–¥–æ–±–Ω—ã–π wrapper –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
./migrate.sh
```

### 3. `init_db.py` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–π –ë–î
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –Ω—É–ª—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python init_db.py                    # –°–æ–∑–¥–∞—Ç—å instance/budget.db
python init_db.py /path/to/new.db   # –°–æ–∑–¥–∞—Ç—å –ë–î –ø–æ –ø—É—Ç–∏
```

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î
```bash
# 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ë–î –∏–∑ –ø—Ä–æ–¥–∞
scp user@prod:/var/lib/crystalbudget/budget.db instance/budget.db

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python migrate_prod_db.py

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
python app.py
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ë–î —Å –Ω—É–ª—è
```bash
# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
python init_db.py

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
python app.py

# 3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
# 1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–æ–ø–∏—é
cp instance/budget.db instance/budget_test.db

# 2. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–æ–ø–∏—é
python migrate_prod_db.py instance/budget_test.db

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
python app.py  # –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î
python migrate_prod_db.py instance/budget.db
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ö–µ–º–µ –ë–î

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
1. **budget_rollover** - –ü–µ—Ä–µ–Ω–æ—Å—ã –±—é–¥–∂–µ—Ç–∞ –º–µ–∂–¥—É –º–µ—Å—è—Ü–∞–º–∏
2. **password_reset_tokens** - –¢–æ–∫–µ–Ω—ã —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
3. **income_backup_monthly** - –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –º–µ—Å—è—á–Ω—ã—Ö –¥–æ—Ö–æ–¥–æ–≤
4. **income_daily** - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –¥–æ—Ö–æ–¥—ã
5. **source_category_rules** - –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—Ö–æ–¥–æ–≤

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ users:
- –ö–æ–ª–æ–Ω–∫–∞ `currency` –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (deprecated)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `default_currency` –≤–º–µ—Å—Ç–æ `currency`
- –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–∞

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:
- `idx_users_telegram_id` - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ telegram_id

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ backup'—ã
–°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ **–≤—Å–µ–≥–¥–∞** —Å–æ–∑–¥–∞–µ—Ç backup:
```
instance/budget.db.backup_20251002_123456
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup
```bash
cp instance/budget.db.backup_YYYYMMDD_HHMMSS instance/budget.db
```

### –ß—Ç–æ –ù–ï –¥–µ–ª–∞—é—Ç —Å–∫—Ä–∏–ø—Ç—ã
- ‚ùå –ù–ï —É–¥–∞–ª—è—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- ‚ùå –ù–ï —É–¥–∞–ª—è—é—Ç —Å—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- ‚ùå –ù–ï –º–µ–Ω—è—é—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
- ‚ùå –ù–ï —Ç—Ä–µ–±—É—é—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞:
- ‚úÖ –ü—Ä–æ–¥–∞–∫—à–Ω –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚úÖ –ü—É—Å—Ç–∞—è –Ω–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å —á–∞—Å—Ç–∏—á–Ω–æ–π —Å—Ö–µ–º–æ–π
- ‚úÖ –†–∞–∑–ª–∏—á–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ SQLite (3.31+)

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- ‚úÖ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞ (–º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑)

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- üìñ `README_MIGRATION.md` - –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- üìñ `MIGRATION_GUIDE.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- üìñ `MIGRATION_SUMMARY.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backup —Å–æ–∑–¥–∞–Ω
2. –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –≤—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞ (—Ç–∞–º –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏)
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–æ–ø–∏–∏ –ë–î
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

## –ß–µ–∫–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

### –ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π:
- [ ] –°–¥–µ–ª–∞—Ç—å –ø–æ–ª–Ω—ã–π backup —Å–µ—Ä–≤–µ—Ä–∞
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ –∫–æ–ø–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ë–î

### –í–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏:
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–≤–æ–¥ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ backup —Å–æ–∑–¥–∞–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ë–î –¥–æ/–ø–æ—Å–ª–µ

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–º–µ–Ω—É –≤–∞–ª—é—Ç—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2025-10-02
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
