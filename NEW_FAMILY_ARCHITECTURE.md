# –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ–º–µ–π–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

1. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `shared_budget_id` –≤ —Ç–∞–±–ª–∏—Ü—É `users`**
   - –ú–∏–≥—Ä–∞—Ü–∏—è `add_shared_budget_to_users` –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
   - –ú–æ–¥–µ–ª—å User –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å –Ω–æ–≤—ã–º –ø–æ–ª–µ–º

2. **–î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –≤ –º–æ–¥–µ–ª—å User:**
   - `has_family_access` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–µ–º–µ–π–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
   - `get_family_members()` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏
   - `get_family_member_ids()` - –ø–æ–ª—É—á–∏—Ç—å ID –≤—Å–µ—Ö —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏

## üîÑ –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç —Å–µ–º–µ–π–Ω—ã–π –¥–æ—Å—Ç—É–ø** –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `shared_budgets`
   - –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `shared_budget_id`
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è

2. **–î—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –ø–æ –∫–æ–¥—É**
   - –í–≤–æ–¥–∏—Ç –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
   - –£ –Ω–µ–≥–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–æ—Ç –∂–µ `shared_budget_id`
   - –¢–µ–ø–µ—Ä—å –æ–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–¥–Ω–æ–π —Å–µ–º—å–µ

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —à–∞—Ä–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö:**
   - –í—Å–µ —Ä–∞—Å—Ö–æ–¥—ã (`expenses`) –≤—Å–µ—Ö —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏ –≤–∏–¥–Ω—ã –≤—Å–µ–º
   - –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (`categories`) –≤—Å–µ—Ö —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏ –≤–∏–¥–Ω—ã –≤—Å–µ–º
   - Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - –î–æ—Ö–æ–¥—ã (`income`) –ù–ï —à–∞—Ä—è—Ç—Å—è - –æ—Å—Ç–∞—é—Ç—Å—è –ª–∏—á–Ω—ã–º–∏

### –û—Ç–ª–∏—á–∏—è –æ—Ç —Å—Ç–∞—Ä–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

**–°—Ç–∞—Ä–∞—è (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è):**
- `shared_budget_id` –±—ã–ª –Ω–∞ —É—Ä–æ–≤–Ω–µ Expense
- –ú–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–±–∏—Ä–∞—Ç—å, –∫–∞–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã —à–∞—Ä–∏—Ç—å, –∞ –∫–∞–∫–∏–µ –Ω–µ—Ç
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –ª–∏—á–Ω—ã–º –∏ —Å–µ–º–µ–π–Ω—ã–º –±—é–¥–∂–µ—Ç–æ–º

**–ù–æ–≤–∞—è (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è):**
- `shared_budget_id` –Ω–∞ —É—Ä–æ–≤–Ω–µ User
- –í–°–ï —Ä–∞—Å—Ö–æ–¥—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—â–∏–µ
- –ü—Ä–æ—â–µ: –ª–∏–±–æ —Ç—ã –≤ —Å–µ–º—å–µ, –ª–∏–±–æ –Ω–µ—Ç

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –û–±–Ω–æ–≤–∏—Ç—å BudgetService ‚úÖ –ö–†–ò–¢–ò–ß–ù–û
–ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ–º–µ–π–Ω—ã–º–∏ ID:

```python
# –ë—ã–ª–æ:
def get_user_expenses(user_id):
    return Expense.query.filter_by(user_id=user_id)

# –°—Ç–∞–ª–æ:
def get_user_expenses(user_id):
    user = User.query.get(user_id)
    family_ids = user.get_family_member_ids()
    return Expense.query.filter(Expense.user_id.in_(family_ids))
```

–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã:
- ‚úÖ `get_user_expenses()`
- ‚úÖ `get_user_categories()`
- ‚úÖ `get_user_accessible_expenses()` - —É–∂–µ –Ω–µ –Ω—É–∂–µ–Ω
- ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤

### 2. –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç—ã –≤ auth –¥–ª—è —Å–µ–º–µ–π–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ ‚úÖ –ö–†–ò–¢–ò–ß–ù–û

```python
@auth_bp.route('/profile/family', methods=['GET'])
@login_required
def family_settings():
    """–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–µ–º–µ–π–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞."""
    pass

@auth_bp.route('/profile/family/create', methods=['POST'])
@login_required
def create_family_access():
    """–°–æ–∑–¥–∞—Ç—å —Å–µ–º–µ–π–Ω—ã–π –¥–æ—Å—Ç—É–ø."""
    pass

@auth_bp.route('/profile/family/join', methods=['POST'])
@login_required
def join_family():
    """–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Å–µ–º—å–µ –ø–æ –∫–æ–¥—É."""
    pass

@auth_bp.route('/profile/family/leave', methods=['POST'])
@login_required
def leave_family():
    """–ü–æ–∫–∏–Ω—É—Ç—å —Å–µ–º–µ–π–Ω—ã–π –¥–æ—Å—Ç—É–ø."""
    pass
```

### 3. –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω –¥–ª—è —Å–µ–º–µ–π–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ ‚úÖ –ö–†–ò–¢–ò–ß–ù–û

`templates/auth/family_settings.html`:
- –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (–≤ —Å–µ–º—å–µ –∏–ª–∏ –Ω–µ—Ç)
- –ï—Å–ª–∏ –Ω–µ –≤ —Å–µ–º—å–µ: –∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å —Å–µ–º–µ–π–Ω—ã–π –¥–æ—Å—Ç—É–ø"
- –ï—Å–ª–∏ –≤ —Å–µ–º—å–µ: —Å–ø–∏—Å–æ–∫ —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏, –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, –∫–Ω–æ–ø–∫–∞ "–ü–æ–∫–∏–Ω—É—Ç—å —Å–µ–º—å—é"
- –§–æ—Ä–º–∞ "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Å–µ–º—å–µ"

### 4. –û–±–Ω–æ–≤–∏—Ç—å —à–∞–±–ª–æ–Ω—ã –±—é–¥–∂–µ—Ç–∞

**dashboard.html:**
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –≤—Å–µ—Ö —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏
- –£–∫–∞–∑—ã–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –∫–∞–∂–¥–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞ (–µ—Å–ª–∏ —Å–µ–º–µ–π–Ω—ã–π –¥–æ—Å—Ç—É–ø)

**expenses.html:**
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ —Ä–∞—Å—Ö–æ–¥–∞
- –í—Å–µ –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å (–Ω–µ—Ç —Ä–æ–ª–µ–π owner/member/viewer)

**categories.html:**
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤—Å–µ—Ö —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏
- –£–∫–∞–∑—ã–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### 5. –û–±–Ω–æ–≤–∏—Ç—å service —Å–ª–æ–π ‚úÖ –ö–†–ò–¢–ò–ß–ù–û

**BudgetService:**
- –í—Å–µ –º–µ—Ç–æ–¥—ã –¥–æ–ª–∂–Ω—ã —É—á–∏—Ç—ã–≤–∞—Ç—å `get_family_member_ids()`
- –ö—ç—à –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏

**–ù–æ–≤—ã–π FamilyService (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
- `create_family_access(user_id)` - —Å–æ–∑–¥–∞—Ç—å
- `join_family(user_id, code)` - –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
- `leave_family(user_id)` - –ø–æ–∫–∏–Ω—É—Ç—å
- `get_invitation_code(user_id)` - –ø–æ–ª—É—á–∏—Ç—å –∫–æ–¥

### 6. –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é

–î–æ–±–∞–≤–∏—Ç—å –≤ –º–µ–Ω—é –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –ø—É–Ω–∫—Ç "–°–µ–º–µ–π–Ω—ã–π –¥–æ—Å—Ç—É–ø"

### 7. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

- –£–¥–∞–ª–∏—Ç—å `shared_budget_id` –∏–∑ —Ç–∞–±–ª–∏—Ü `expenses` –∏ `categories`
- –£–¥–∞–ª–∏—Ç—å —Ä–æ—É—Ç—ã `/budget/shared/<id>/expenses`
- –£–¥–∞–ª–∏—Ç—å –º–æ–¥—É–ª—å goals (–µ—Å–ª–∏ –æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ–º–µ–π–Ω—ã—Ö –±—é–¥–∂–µ—Ç–æ–≤)

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–¥–∞—á

**–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å):**
1. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å BudgetService
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç—ã –¥–ª—è —Å–µ–º–µ–π–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –≤ auth
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω family_settings.html
4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å dashboard –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ–º–µ–π–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ø–æ—Å–ª–µ –±–∞–∑–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞):**
5. –û–±–Ω–æ–≤–∏—Ç—å expenses.html –∏ categories.html
6. –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é
7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∫–æ–≥–¥–∞ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):**
8. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É
9. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü—Ä–æ–≤–µ—Ä—è—Ç—å `shared_budget_id` –ø—Ä–∏ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –¥–ª—è –≤—Å–µ—Ö —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏
- –ù–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å —á—É–∂–∏–µ –¥–æ—Ö–æ–¥—ã (–æ–Ω–∏ –Ω–µ —à–∞—Ä—è—Ç—Å—è)

## üìä –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

```python
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã —Å–µ–º—å–∏
user = User.query.get(user_id)
family_ids = user.get_family_member_ids()  # [1, 2, 3]
expenses = Expense.query.filter(Expense.user_id.in_(family_ids)).all()

# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–µ–º—å–∏
categories = Category.query.filter(Category.user_id.in_(family_ids)).all()

# –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Ö–æ–¥—ã (—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏, –Ω–µ —à–∞—Ä—è—Ç—Å—è!)
income = Income.query.filter_by(user_id=user_id).all()
```

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ü—Ä–æ—â–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - —Å–æ–∑–¥–∞–ª —Å–µ–º—å—é, –∏ –≤—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—â–µ–µ
2. **–ú–µ–Ω—å—à–µ –∫–æ–¥–∞** - –Ω–µ –Ω—É–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å, —á—Ç–æ —à–∞—Ä–∏—Ç—å
3. **–ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –æ–¥–Ω–∞ –ª–æ–≥–∏–∫–∞, –Ω–µ –¥–≤–µ (–ª–∏—á–Ω—ã–π/—Å–µ–º–µ–π–Ω—ã–π)
4. **–ë—ã—Å—Ç—Ä–µ–µ** - –º–µ–Ω—å—à–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ —É—Å–ª–æ–≤–∏–π
5. **–ü–æ–Ω—è—Ç–Ω–µ–µ** - –ª–∏–±–æ —Ç—ã –≤ —Å–µ–º—å–µ, –ª–∏–±–æ –Ω–µ—Ç

## üöÄ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–ù–∞—á–∞—Ç—å —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è BudgetService - —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–≤–∏—Å–∏—Ç –≤–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.
