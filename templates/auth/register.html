{% extends "base.html" %}
{% block title %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - CrystalBudget{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6 col-lg-4">
        <div class="card">
            <div class="card-body">
                <div class="text-center mb-4">
                    <h2 class="card-title">üíé –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                    <p class="text-muted">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç CrystalBudget</p>
                </div>
                
                <!-- Flash Messages -->
                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        <div class="alert alert-danger">
                            {% for message in messages %}
                                {{ message }}
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}

                <!-- Telegram Registration -->
                <div class="text-center mb-4">
                    <div id="telegram-widget-container">
                        <script async src="https://telegram.org/js/telegram-widget.js?22"
                          data-telegram-login="crystalbudget_bot"
                          data-size="large"
                          data-userpic="false"
                          data-request-access="write" 
                          data-auth-url="{{ request.url_root }}auth/telegram?next={{ url_for('budget.dashboard') }}">
                        </script>
                    </div>
                    <!-- Fallback button if widget doesn't load -->
                    <div id="telegram-fallback" style="display: none;" class="mt-2">
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle"></i>
                            Telegram –≤–∏–¥–∂–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
                            <ul class="mt-2 mb-0">
                                <li>–î–æ–º–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ @BotFather</li>
                                <li>–¢—Ä–µ–±—É–µ—Ç—Å—è HTTPS</li> 
                                <li>–ë–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫ —Ä–µ–∫–ª–∞–º—ã</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <script>
                // Check if Telegram widget loaded after 3 seconds
                setTimeout(function() {
                    const container = document.getElementById('telegram-widget-container');
                    const fallback = document.getElementById('telegram-fallback');
                    
                    if (!container.querySelector('iframe')) {
                        console.warn('Telegram widget failed to load');
                        fallback.style.display = 'block';
                    }
                }, 3000);
                </script>
                
                <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
                <div class="text-center my-4">
                    <span class="text-muted">–∏–ª–∏</span>
                </div>
                
                <!-- Email Registration -->
                <form method="POST" action="{{ url_for('auth.register') }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </form>
                
                <div class="text-center">
                    <p class="text-muted mb-0">
                        –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? 
                        <a href="{{ url_for('auth.login') }}" class="text-decoration-none">
                            –í–æ–π—Ç–∏
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}