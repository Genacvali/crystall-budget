<!-- Шаблон модальной формы редактирования дохода -->
<!-- Используется для GET /modals/income/<id>/edit -->

<div class="cb-modal__header">
    <h5 class="cb-modal__title">
        <i class="bi bi-pencil me-2"></i>Редактировать доход
    </h5>
    <button type="button" class="cb-modal__close" data-modal-close aria-label="Закрыть">
        <i class="bi bi-x-lg"></i>
    </button>
</div>

<div class="cb-modal__body">
<form method="POST" action="{{ url_for('budget.edit_income', income_id=income.id) }}"
      data-form="income-edit" role="form" aria-label="Форма редактирования дохода" novalidate id="incomeEditFormInner">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    
    <div class="row g-3">
        <div class="col-12 col-md-6">
            <label class="form-label">Дата <span class="text-danger">*</span></label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-calendar-event" aria-hidden="true"></i></span>
                <input type="date" class="form-control" name="date" 
                       value="{{ income.date.strftime('%Y-%m-%d') if income.date else (income.year|string + '-' + income.month|string|rjust(2, '0') + '-01') }}" required>
            </div>
        </div>

        <div class="col-12 col-md-6">
            <label class="form-label">Сумма <span class="text-danger">*</span></label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-cash-coin" aria-hidden="true"></i></span>
                <input type="text" class="form-control" name="amount" id="amount"
                       inputmode="decimal" value="{{ income.amount }}"
                       pattern="^\s*\d+([,\.]\d{1,2})?\s*$" required>
            </div>
            <div class="form-text">Запятая или точка, 2 знака после.</div>
        </div>

        <div class="col-12">
            <label class="form-label">Источник дохода <span class="text-danger">*</span></label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-briefcase" aria-hidden="true"></i></span>
                <input type="text" class="form-control" name="source_name" id="source_name"
                       value="{{ income.source_name or '' }}" placeholder="Например, Зарплата" required>
            </div>
        </div>
    </div>
    
    <!-- Область для отображения общих ошибок формы -->
    <div class="mt-3 d-none" role="alert" aria-live="assertive" aria-atomic="true" id="form-errors">
        <div class="alert alert-danger">
            <strong>Ошибка:</strong> <span id="form-error-text"></span>
        </div>
    </div>
    
    <!-- Индикатор загрузки -->
    <div class="mt-3 text-center d-none" id="form-loading" role="status" aria-live="polite">
        <span class="loading-spinner" aria-hidden="true"></span>
        <span class="visually-hidden">Сохранение изменений…</span>
    </div>
</form>
</div>

<div class="cb-modal__footer">
    <div class="cb-modal__actions cb-modal__actions--full">
        <button type="button" class="cb-modal__btn cb-modal__btn--outline" data-modal-close>
            Отмена
        </button>
        <button type="submit" form="incomeEditFormInner" class="cb-modal__btn cb-modal__btn--success">
            <i class="bi bi-check-lg me-1"></i>Сохранить
        </button>
    </div>
</div>

<!-- Script logic moved to modals.js initIncomeEditForm() -->