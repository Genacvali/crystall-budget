<!-- –®–∞–±–ª–æ–Ω –º–æ–¥–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ -->
<!-- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è GET /modals/settings/interface -->

<form method="POST" action="{{ url_for('settings_save_interface') }}" 
      data-form="settings-interface" role="form" aria-label="–§–æ—Ä–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞" novalidate>
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    
    <div class="row g-4">
        <!-- –¢–µ–º–∞ -->
        <div class="col-12">
            <h6 class="mb-3">
                <i class="bi bi-palette me-2"></i>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
            </h6>
            <div class="row g-3">
                <div class="col-6 col-md-4">
                    <input type="radio" class="btn-check" name="theme" value="light" id="theme-light" 
                           {{ 'checked' if not session.get('theme') or session.get('theme') == 'light' else '' }}>
                    <label class="btn btn-outline-primary w-100 text-start" for="theme-light">
                        <i class="bi bi-sun me-2"></i>
                        <div>
                            <div class="fw-semibold">–°–≤–µ—Ç–ª–∞—è</div>
                            <small class="text-muted">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω</small>
                        </div>
                    </label>
                </div>
                <div class="col-6 col-md-4">
                    <input type="radio" class="btn-check" name="theme" value="dark" id="theme-dark"
                           {{ 'checked' if session.get('theme') == 'dark' else '' }}>
                    <label class="btn btn-outline-primary w-100 text-start" for="theme-dark">
                        <i class="bi bi-moon-stars me-2"></i>
                        <div>
                            <div class="fw-semibold">–¢—ë–º–Ω–∞—è</div>
                            <small class="text-muted">–î–ª—è —Ä–∞–±–æ—Ç—ã –≤ —Ç–µ–º–Ω–æ—Ç–µ</small>
                        </div>
                    </label>
                </div>
                <div class="col-6 col-md-4">
                    <input type="radio" class="btn-check" name="theme" value="auto" id="theme-auto">
                    <label class="btn btn-outline-primary w-100 text-start" for="theme-auto">
                        <i class="bi bi-circle-half me-2"></i>
                        <div>
                            <div class="fw-semibold">–ê–≤—Ç–æ</div>
                            <small class="text-muted">–ü–æ —Å–∏—Å—Ç–µ–º–µ</small>
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ -->
        <div class="col-12">
            <h6 class="mb-3">
                <i class="bi bi-translate me-2"></i>–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            </h6>
            <div class="row g-2">
                <div class="col-6 col-md-4">
                    <input type="radio" class="btn-check" name="language" value="ru" id="lang-ru" checked>
                    <label class="btn btn-outline-secondary w-100" for="lang-ru">
                        üá∑üá∫ –†—É—Å—Å–∫–∏–π
                    </label>
                </div>
                <div class="col-6 col-md-4">
                    <input type="radio" class="btn-check" name="language" value="en" id="lang-en" disabled>
                    <label class="btn btn-outline-secondary w-100" for="lang-en">
                        üá∫üá∏ English
                        <small class="d-block text-muted">–°–∫–æ—Ä–æ</small>
                    </label>
                </div>
            </div>
        </div>

        <!-- –ü–ª–æ—Ç–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ -->
        <div class="col-12">
            <h6 class="mb-3">
                <i class="bi bi-grid me-2"></i>–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            </h6>
            <div class="row g-2">
                <div class="col-md-4">
                    <input type="radio" class="btn-check" name="density" value="compact" id="density-compact">
                    <label class="btn btn-outline-secondary w-100 text-start" for="density-compact">
                        <div class="fw-semibold">–ö–æ–º–ø–∞–∫—Ç–Ω–∞—è</div>
                        <small class="text-muted">–ë–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö</small>
                    </label>
                </div>
                <div class="col-md-4">
                    <input type="radio" class="btn-check" name="density" value="normal" id="density-normal" checked>
                    <label class="btn btn-outline-secondary w-100 text-start" for="density-normal">
                        <div class="fw-semibold">–û–±—ã—á–Ω–∞—è</div>
                        <small class="text-muted">–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ</small>
                    </label>
                </div>
                <div class="col-md-4">
                    <input type="radio" class="btn-check" name="density" value="comfortable" id="density-comfortable">
                    <label class="btn btn-outline-secondary w-100 text-start" for="density-comfortable">
                        <div class="fw-semibold">–ö–æ–º—Ñ–æ—Ä—Ç–Ω–∞—è</div>
                        <small class="text-muted">–ë–æ–ª—å—à–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞</small>
                    </label>
                </div>
            </div>
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="col-12">
            <h6 class="mb-3">
                <i class="bi bi-toggles me-2"></i>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            </h6>
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="animations" id="animations" checked>
                        <label class="form-check-label" for="animations">
                            <div class="fw-semibold">–ê–Ω–∏–º–∞—Ü–∏–∏</div>
                            <small class="text-muted">–ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã</small>
                        </label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="sounds" id="sounds">
                        <label class="form-check-label" for="sounds">
                            <div class="fw-semibold">–ó–≤—É–∫–∏</div>
                            <small class="text-muted">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</small>
                        </label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="tooltips" id="tooltips" checked>
                        <label class="form-check-label" for="tooltips">
                            <div class="fw-semibold">–ü–æ–¥—Å–∫–∞–∑–∫–∏</div>
                            <small class="text-muted">–í—Å–ø–ª—ã–≤–∞—é—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏</small>
                        </label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="keyboard_shortcuts" id="keyboard_shortcuts" checked>
                        <label class="form-check-label" for="keyboard_shortcuts">
                            <div class="fw-semibold">–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</div>
                            <small class="text-muted">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</small>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä -->
        <div class="col-12">
            <div class="card bg-light border-0">
                <div class="card-body">
                    <h6 class="card-title mb-3">
                        <i class="bi bi-eye me-2"></i>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
                    </h6>
                    <div class="preview-area p-3 border rounded bg-white" data-theme-preview>
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <span class="fw-semibold">–ü—Ä–∏–º–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏</span>
                            <span class="badge bg-primary">–ù–æ–≤–æ–µ</span>
                        </div>
                        <p class="text-muted small mb-2">–¢–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.</p>
                        <div class="d-flex gap-2">
                            <button class="btn btn-primary btn-sm">–û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞</button>
                            <button class="btn btn-outline-secondary btn-sm">–í—Ç–æ—Ä–∏—á–Ω–∞—è</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –û–±–ª–∞—Å—Ç—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–∏—Ö –æ—à–∏–±–æ–∫ —Ñ–æ—Ä–º—ã -->
    <div class="mt-3 d-none" role="alert" aria-live="assertive" aria-atomic="true" id="form-errors">
        <div class="alert alert-danger">
            <strong>–û—à–∏–±–∫–∞:</strong> <span id="form-error-text"></span>
        </div>
    </div>
    
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="mt-3 text-center d-none" id="form-loading" role="status" aria-live="polite">
        <span class="loading-spinner" aria-hidden="true"></span>
        <span class="visually-hidden">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫‚Ä¶</span>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.querySelector('form[data-form="settings-interface"]');
  if (!form) return;

  const previewArea = form.querySelector('[data-theme-preview]');
  const themeInputs = form.querySelectorAll('input[name="theme"]');
  const densityInputs = form.querySelectorAll('input[name="density"]');
  const errBox = form.querySelector('#form-errors');
  const errText = form.querySelector('#form-error-text');
  const loading = form.querySelector('#form-loading');

  // –æ—Ç–º–µ—á–∞–µ–º –ø–æ–ª—è –∫–∞–∫ "dirty" –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤–≤–æ–¥–∞/blur
  form.querySelectorAll('input, select, textarea').forEach(el => {
    el.addEventListener('input', () => el.classList.add('dirty'));
    el.addEventListener('blur',  () => el.classList.add('dirty'));
  });

  // Live preview updates
  function updatePreview() {
    const selectedTheme = form.querySelector('input[name="theme"]:checked')?.value || 'light';
    const selectedDensity = form.querySelector('input[name="density"]:checked')?.value || 'normal';
    
    if (previewArea) {
      // Apply theme to preview
      previewArea.setAttribute('data-bs-theme', selectedTheme);
      previewArea.className = previewArea.className.replace(/\s*preview-\w+/g, '');
      previewArea.classList.add(`preview-${selectedDensity}`);
    }
  }

  // Theme change listeners
  themeInputs.forEach(input => {
    input.addEventListener('change', () => {
      updatePreview();
      
      // Apply theme immediately for live preview
      const theme = input.value;
      if (theme !== 'auto') {
        document.documentElement.setAttribute('data-bs-theme', theme);
      } else {
        // Auto theme - detect system preference
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute('data-bs-theme', prefersDark ? 'dark' : 'light');
      }
    });
  });

  // Density change listeners
  densityInputs.forEach(input => {
    input.addEventListener('change', updatePreview);
  });

  // Initial preview update
  updatePreview();

  form.addEventListener('submit', (e) => {
    if (!form.checkValidity()) {
      e.preventDefault();
      e.stopPropagation();
      form.classList.add('was-validated');
      return;
    }

    // –ø–æ–∫–∞–∑–∞—Ç—å –ª–æ–∞–¥–µ—Ä –∏ —Å–∫—Ä—ã—Ç—å –æ—à–∏–±–∫—É
    loading?.classList.remove('d-none');
    errBox?.classList.add('d-none');
  });
});
</script>

<style>
.preview-compact { font-size: 0.875rem; }
.preview-comfortable { padding: 1.25rem !important; font-size: 1.1rem; }
.preview-area[data-bs-theme="dark"] { 
  background-color: var(--bs-dark) !important; 
  color: var(--bs-light) !important; 
  border-color: var(--bs-secondary) !important;
}
</style>