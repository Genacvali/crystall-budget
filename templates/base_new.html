{% macro tooltip_button(content, tooltip_text) -%}
<div class="tooltip-wrapper" data-bs-toggle="tooltip" data-bs-title="{{ tooltip_text }}">
  {{ content }}
</div>
{%- endmacro %}

{% macro tooltip_link(href, content, tooltip_text, class="") -%}
<a href="{{ href }}" class="{{ class }}" data-bs-toggle="tooltip" data-bs-title="{{ tooltip_text }}">
  {{ content }}
</a>
{%- endmacro %}

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="color-scheme" content="light dark">
  <title>{% block title %}ðŸ’Ž CrystalBudget - Modern Finance{% endblock %}</title>

  <!-- Favicon -->
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='icons/icon-192.png') }}">
  <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='icons/icon-512.png') }}">

  <!-- PWA -->
  <link rel="manifest" href="{{ url_for('static', filename='manifest.webmanifest') }}">
  <meta name="theme-color" content="#4fb3d9">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CrystalBudget">
  <link rel="apple-touch-icon" sizes="192x192" href="{{ url_for('static', filename='icons/icon-192.png') }}">
  <link rel="apple-touch-icon" sizes="512x512" href="{{ url_for('static', filename='icons/icon-512.png') }}">
  <meta name="format-detection" content="telephone=no">

  <!-- Bootstrap CSS Ð¸ Icons -->
  <link href="{{ url_for('static', filename='vendor/bootstrap/bootstrap.min.css') }}" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/bootstrap-icons/bootstrap-icons.css') }}">
  <!-- Base styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">

  <!-- Page-specific styles -->
  {% block head %}{% endblock %}

  <!-- Theme initialization -->
  <script>
    (function() {
      const serverTheme = '{{ session.get("theme", "light") }}';
      const savedTheme = localStorage.getItem('theme') || serverTheme ||
        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      document.documentElement.setAttribute('data-bs-theme', savedTheme);
      const meta = document.querySelector('meta[name="theme-color"]');
      if (meta) meta.content = savedTheme === 'dark' ? '#212529' : '#4fb3d9';
    })();
  </script>
</head>
<body>

  {% include "partials/_navbar.html" %}
  {% include "partials/_sidebar.html" %}

  <div class="container-modern py-4">
    {% include "partials/_toasts.html" %}
    {% block content %}{% endblock %}
  </div>

  <!-- Bootstrap JS -->
  <script defer src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
  <!-- Offline functionality -->
  <script src="{{ url_for('static', filename='js/offline.js') }}"></script>

  <!-- PWA SW -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/sw.js').catch(console.error);
      });
    }
  </script>

  <!-- Page-specific scripts -->
  {% block scripts %}{% endblock %}
</body>
</html>