{% extends "base.html" %}
{% block title %}Issue Tracker â€” CrystalBudget{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ versioned_static('css/kanban.css') }}">
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>
    <i class="bi bi-kanban me-2"></i>Issue Tracker
  </h1>
  
  <div class="d-flex gap-2">
    <a href="{{ url_for('issues.diagnostics_report') }}" class="btn btn-outline-info">
      <i class="bi bi-graph-up me-1"></i>Diagnostics
    </a>
    <a href="{{ url_for('issues.create_issue') }}" class="btn btn-primary">
      <i class="bi bi-plus-lg me-1"></i>New Issue
    </a>
  </div>
</div>

<!-- Stats Cards -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card bg-primary text-white">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h5 class="card-title mb-1">{{ stats.total }}</h5>
            <p class="card-text small mb-0">Total Issues</p>
          </div>
          <i class="bi bi-clipboard-data fs-3"></i>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-3">
    <div class="card bg-danger text-white">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h5 class="card-title mb-1">{{ stats.blockers }}</h5>
            <p class="card-text small mb-0">Blockers</p>
          </div>
          <i class="bi bi-exclamation-triangle fs-3"></i>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-3">
    <div class="card bg-warning text-white">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h5 class="card-title mb-1">{{ stats.in_progress }}</h5>
            <p class="card-text small mb-0">In Progress</p>
          </div>
          <i class="bi bi-gear fs-3"></i>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-3">
    <div class="card bg-info text-white">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h5 class="card-title mb-1">{{ stats.open }}</h5>
            <p class="card-text small mb-0">Open</p>
          </div>
          <i class="bi bi-folder2-open fs-3"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Kanban Board -->
<div class="kanban-board">
  {% for status in statuses %}
    <div class="kanban-column" data-status="{{ status.value }}">
      <div class="kanban-header">
        <h5 class="mb-0">
          {{ status.value.replace('_', ' ').title() }}
          <span class="badge bg-secondary ms-1">{{ issues_by_status[status.value]|length }}</span>
        </h5>
      </div>
      
      <div class="kanban-body" id="column-{{ status.value }}">
        {% for issue in issues_by_status[status.value] %}
          {% include 'issues/_issue_card.html' %}
        {% endfor %}
        
        {% if not issues_by_status[status.value] %}
          <div class="kanban-empty">
            <i class="bi bi-inbox text-muted"></i>
            <p class="text-muted small mb-0">No issues</p>
          </div>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>

<!-- Modals -->
{% include 'issues/_quick_edit_modal.html' %}
{% endblock %}

{% block page_js %}
<script src="{{ versioned_static('js/kanban.js') }}"></script>
{% endblock %}