{% extends "base.html" %}
{% block title %}–ü—Ä–æ—Ñ–∏–ª—å ‚Äî CrystalBudget{% endblock %}

{% block content %}
<div class="ynab-card mb-4">
  <div class="ynab-card-header">
    <h5 class="mb-0"><i class="bi bi-person-circle me-2"></i>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h5>
  </div>
  <div class="ynab-card-body">
    <form method="POST" action="{{ url_for('update_profile') }}">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" name="email" value="{{ user.email }}" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">–ò–º—è</label>
          <input type="text" class="form-control" name="name" value="{{ user.name }}" required>
        </div>
        <div class="col-md-6">
          <label class="form-label text-muted">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</label>
          <div class="form-control-plaintext">{{ user.created_at|format_date_with_day if user.created_at else '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' }}</div>
        </div>
        <div class="col-md-6">
          <label class="form-label text-muted">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</label>
          <div class="form-control-plaintext">{{ user.last_login|format_date_with_day if user.last_login else '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' }}</div>
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-check-lg me-1"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="ynab-card mb-4">
  <div class="ynab-card-header">
    <h5 class="mb-0"><i class="bi bi-gear me-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
  </div>
  <div class="ynab-card-body">
    <form method="POST" action="{{ url_for('set_currency') }}" class="row g-3">
      <div class="col-md-8">
        <label class="form-label">–í–∞–ª—é—Ç–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</label>
        <select class="form-select" name="currency">
          {% for c in ['RUB','USD','EUR','AMD','GEL'] %}
          <option value="{{ c }}" {% if c == session.get('currency', 'RUB') %}selected{% endif %}>
            {% if c == 'RUB' %}üá∑üá∫ –†—É–±–ª–∏ (‚ÇΩ){% endif %}
            {% if c == 'USD' %}üá∫üá∏ –î–æ–ª–ª–∞—Ä—ã ($){% endif %}
            {% if c == 'EUR' %}üá™üá∫ –ï–≤—Ä–æ (‚Ç¨){% endif %}
            {% if c == 'AMD' %}üá¶üá≤ –î—Ä–∞–º—ã (÷è){% endif %}
            {% if c == 'GEL' %}üá¨üá™ –õ–∞—Ä–∏ (‚Çæ){% endif %}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">
          <i class="bi bi-check-lg me-1"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∞–ª—é—Ç—É
        </button>
      </div>
    </form>
  </div>
</div>

<div class="ynab-card mb-4">
  <div class="ynab-card-header">
    <h5 class="mb-0"><i class="bi bi-shield-lock me-2"></i>–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h5>
  </div>
  <div class="ynab-card-body">
    <form method="POST" action="{{ url_for('account_password') }}">
      <div class="row g-3">
        <div class="col-12">
          <label class="form-label">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
          <input type="password" class="form-control" name="old_password" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
          <input type="password" class="form-control" name="new_password" minlength="6" required>
          <div class="form-text">–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</div>
        </div>
        <div class="col-md-6">
          <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
          <input type="password" class="form-control" name="confirm_password" minlength="6" required>
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-warning">
            <i class="bi bi-key me-1"></i>–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="ynab-card">
  <div class="ynab-card-header">
    <h5 class="mb-0"><i class="bi bi-download me-2"></i>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h5>
  </div>
  <div class="ynab-card-body">
    <p class="text-muted mb-3">–°–∫–∞—á–∞–π—Ç–µ –∫–æ–ø–∏—é –≤—Å–µ—Ö –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞.</p>
    <div class="d-flex gap-2">
      <button class="btn btn-outline-primary" onclick="alert('–≠–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
        <i class="bi bi-file-text me-1"></i>–≠–∫—Å–ø–æ—Ä—Ç CSV
      </button>
      <button class="btn btn-outline-primary" onclick="alert('–≠–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
        <i class="bi bi-file-code me-1"></i>–≠–∫—Å–ø–æ—Ä—Ç JSON
      </button>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
    const newPasswordInput = document.querySelector('input[name="new_password"]');
    const confirmPasswordInput = document.querySelector('input[name="confirm_password"]');
    
    function checkPasswordMatch() {
        if (newPasswordInput.value && confirmPasswordInput.value) {
            if (newPasswordInput.value !== confirmPasswordInput.value) {
                confirmPasswordInput.setCustomValidity('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
            } else {
                confirmPasswordInput.setCustomValidity('');
            }
        }
    }
    
    if (newPasswordInput && confirmPasswordInput) {
        newPasswordInput.addEventListener('input', checkPasswordMatch);
        confirmPasswordInput.addEventListener('input', checkPasswordMatch);
    }
});
</script>
{% endblock %}