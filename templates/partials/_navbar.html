{# Navbar partial - expects: session.user_id, request.endpoint #}
{% if session.user_id %}
<nav class="navbar navbar-expand-lg navbar-light navbar-modern">
  <div class="container-fluid">
    <a class="navbar-brand-modern" href="{{ url_for('dashboard') }}">
      <!-- логотип -->
      <svg class="ff-crystal" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="crystalGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#60A5FA;stop-opacity:1"/><stop offset="25%" style="stop-color:#3B82F6;stop-opacity:1"/><stop offset="50%" style="stop-color:#1D4ED8;stop-opacity:1"/><stop offset="75%" style="stop-color:#1E40AF;stop-opacity:1"/><stop offset="100%" style="stop-color:#1E3A8A;stop-opacity:1"/>
          </linearGradient>
        </defs>
        <path d="M12 2L16 6L20 10L16 18L12 22L8 18L4 10L8 6L12 2Z" fill="url(#crystalGradient)"/>
      </svg>
      CrystalBudget
    </a>

    <button class="navbar-toggler" type="button" data-action="toggle-sidebar">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="d-none d-lg-flex collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <a class="nav-link-modern {% if request.endpoint == 'dashboard' %}active{% endif %}" href="{{ url_for('dashboard') }}">
            <i class="bi bi-house-door"></i> Дашборд
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link-modern {% if request.endpoint == 'expenses' %}active{% endif %}" href="{{ url_for('expenses') }}">
            <i class="bi bi-wallet2"></i> Расходы
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link-modern {% if request.endpoint == 'categories' %}active{% endif %}" href="{{ url_for('categories') }}">
            <i class="bi bi-tags"></i> Категории
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link-modern {% if request.endpoint in ['income_page','edit_income'] %}active{% endif %}" href="{{ url_for('income_page') }}">
            <i class="bi bi-cash-coin"></i> Доходы
          </a>
        </li>
      </ul>

      <ul class="navbar-nav">
        {% include "partials/_offline_badge.html" %}
        <li class="nav-item me-3">
          <div class="theme-toggle" data-action="toggle-theme">
            <i class="bi bi-sun-fill" id="light-icon"></i>
            <div class="theme-switch" id="theme-switch"></div>
            <i class="bi bi-moon-fill" id="dark-icon"></i>
          </div>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link-modern dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
            <i class="bi bi-person-circle"></i> {{ session.name or session.email }}
          </a>
          <ul class="dropdown-menu dropdown-menu-end modern-card" style="border:none;">
            <li>
              <a class="dropdown-item nav-link-modern" href="{{ url_for('account') }}">
                <i class="bi bi-gear"></i> Личный кабинет
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item nav-link-modern" href="{{ url_for('logout') }}">
                <i class="bi bi-box-arrow-right"></i> Выйти
              </a>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
{% endif %}